
CREATE TABLE wikiboxes (
    id serial NOT NULL,
    wiki_id integer NOT NULL,
    version serial NOT NULL,
    comment text DEFAULT ''::text NOT NULL,
    author text DEFAULT ''::text NOT NULL,
    content text NOT NULL,
    datetime timestamp without time zone DEFAULT now() NOT NULL,
    PRIMARY KEY (id, version)
);


ALTER TABLE public.wikiboxes OWNER TO %%USER%%;

CREATE TABLE wikipages (
    wiki integer NOT NULL, --  REFERENCES wikis(id)
    id integer NOT NULL, --  REFERENCES wikiboxes(id)
    pagename text DEFAULT ''::text NOT NULL UNIQUE
);

ALTER TABLE public.wikipages OWNER TO %%USER%%;

--
-- Name: COLUMN wikiboxes.wik_id; Type: COMMENT; Schema: public; Owner: %%USER%%
--

COMMENT ON COLUMN wikiboxes.wiki_id IS 'wiki';

--
-- Name: wikis; Type: TABLE; Schema: public; Owner: %%USER%%; Tablespace: 
--

CREATE TABLE wikis (
    id serial NOT NULL primary key,
    title text DEFAULT ''::text NOT NULL,
    descr text DEFAULT ''::text NOT NULL,
    path text,
    pagecreators integer NOT NULL, -- group of users who can create pages
    reader integer NOT NULL, -- default reader
    writer integer NOT NULL, -- default writer
    wikiadmin integer        -- the (default) group who can change rights
                             -- for boxes. NULL = No one
);


ALTER TABLE public.wikis OWNER TO %%USER%%;


--
-- Data for Name: wikipages; Type: TABLE DATA; Schema: public; Owner: %%USER%%
--

-- COPY wikipages (id, suffix, wik_id, txt_id, author, datetime, subject) FROM stdin;
-- \.


--
-- Data for Name: wikis; Type: TABLE DATA; Schema: public; Owner: %%USER%%
--

-- COPY wikis (id, title, descr) FROM stdin;
-- \.

CREATE TABLE wikiboxreaders (
    wiki_id integer NOT NULL,
    id integer NOT NULL,
    reader integer NOT NULL,
    CONSTRAINT uni_r UNIQUE (wiki_id, id, reader)
);

CREATE TABLE wikiboxwriters (
    wiki_id integer NOT NULL,
    id integer NOT NULL,
    writer integer NOT NULL,
    CONSTRAINT uni_w UNIQUE (wiki_id, id, writer)
);

CREATE TABLE wikiboxadmins (
    wiki_id integer NOT NULL,
    id integer NOT NULL,
    wbadmin integer NOT NULL,
    CONSTRAINT uni_a UNIQUE (wiki_id, id, wbadmin)
);

